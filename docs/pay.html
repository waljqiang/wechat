<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
<HEAD>
<meta charset="utf-8">
<link type="text/css" rel="stylesheet" href="./css/apitest.css" />
<link type="text/css" rel="stylesheet" href="./css/bootstrap.css" />
<script src="./js/jquery-1.7.2.min.js"></script>
<script src="./js/common.js"></script>
</HEAD>
<body>
	<div id="box_opration" class="layout_main_top">
		<div class="main_header">Namespace</div>
        <div class="main_body">Waljqiang\Wechat\Handles</div>
	</div>
    <div id="box_opration" class="layout_main_top">
        <div class="main_header">class</div>
        <div class="main_body">class Native extends <a href="./base.html" onclick="showParent('#wechat',2)">Base</a></div>
        <div class="main_body">扫码支付,JSAPI支付,H5支付</div>
    </div>
    
    <div id="box_expresion" class="layout_main_middle">
    	<table class="tbl_params">
            <thead class="thead_params">
                <tr>
                    <td width="15%">Detail说明</td>
                    <td width="30%"></td>
                    <td width="35%"></td>
                    <td></td>         
                </tr>
            </thead>
        </table>
        <table class="tbl_params">
            <thead class="thead_params">
                <tr>
                    <td width="15%">字段说明</td>
                    <td width="30%"></td>
                    <td width="35%"></td>
                    <td></td>         
                </tr>
            </thead>
            <tbody class="tbody_params">
                <tr>
                    <td>integer</td>
                    <td>detail.cost_price</td>
                    <td>订单原价</td>
                    <td>非必须,1.商户侧一张小票订单可能被分多次支付,订单原价用于记录整张小票的交易金额.2.当订单原价与支付金额不相等,则不享受优惠.3.该字段主要用于防止同一张小票分多次支付,以享受多次优惠的情况,正常支付订单不必上传此参数.</td>
                </tr>
                <tr>
                    <td>string(32)</td>
                    <td>detail.receipt_id</td>
                    <td>商品小票ID</td>
                    <td>非必须</td>
                </tr>
                <tr>
                    <td>sting</td>
                    <td>goods_detail</td>
                    <td>单品列表</td>
                    <td>使用数组格式</td>
                </tr>
                <tr>
                    <td>sting(32)</td>
                    <td>detail.goods_detail.goods_id</td>
                    <td>商品编码</td>
                    <td>由半角的大小写字母、数字、中划线、下划线中的一种或几种组成</td>
                </tr>
                <tr>
                    <td>sting(32)</td>
                    <td>detail.goods_detail.wxpay_goods_id</td>
                    <td>微信侧商品编码</td>
                    <td>非必须,微信支付定义的统一商品编号</td>
                </tr>
                <tr>
                    <td>sting(256)</td>
                    <td>detail.goods_detail.goods_name</td>
                    <td>商品名称</td>
                    <td>商品的实际名称</td>
                </tr>
                <tr>
                    <td>integer</td>
                    <td>detail.goods_detail.quantity</td>
                    <td>商品名称</td>
                    <td>商品的实际名称</td>
                </tr>
                <tr>
                    <td>integer</td>
                    <td>detail.goods_detail.price</td>
                    <td>商品单价</td>
                    <td>单位为:分.如果商户有优惠,需传输商户优惠后的单价(例如:用户对一笔100元的订单使用了商场发的纸质优惠券100-50,则活动商品的单价应为原单价-50)</td>
                </tr>
            </tbody>
        </table>

        <table class="tbl_params">
            <thead class="thead_params">
                <tr>
                    <td>示例</td>        
                </tr>
            </thead>
            <tbody class="tbody_params">
                <tr>
                    <td><pre>
[
    "cost_price" => 608800, 
    "receipt_id" => "wx123", 
    "goods_detail" => [ //注意goods_detail字段的格式为"goods_detail":[[]],较多商户写成"goods_detail":[]
        [
            "goods_id" => "商品编码", 
            "wxpay_goods_id" => "1001", 
            "goods_name" => "", 
            "quantity" => 1, 
            "price" => 528800
        ], 
        [
            "goods_id" => "商品编码", 
            "wxpay_goods_id" => "1002", 
            "goods_name" => "iPhone6s 32G", 
            "quantity" => 1, 
            "price" => 608800
        ]
    ]
]
                    </pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div id="box_expresion" class="layout_main_middle">
        <table class="tbl_params">
            <thead class="thead_params">
                <tr>
                    <td width="15%">Methods</td>
                    <td width="30%"></td>
                    <td width="35%"></td>
                    <td></td>         
                </tr>
            </thead>
        </table>
        <div>
        	<div class="methods_body">public unifiedOrder($data,$payConfig = [],$timeOut = 6)</div>
	  		<table class="tbl_params">
	            <thead class="thead_params">
	                <tr>
	                    <td>说明</td>       
	                </tr>
	            </thead>
	            <tbody class="tbody_params">
	            	<tr>
	                    <td>统一下单</td>
	                </tr>
	                <tr>
	                    <td>支持NATIVE(支付二维码)</td>
	                </tr>
	            </tbody>
	       	</table>

	       	 <table class="tbl_params">
	            <thead class="thead_params">
	                <tr>
	                    <td width="10%">参数说明</td>
	                    <td width="10%"></td>
	                    <td width="20%"></td>
	                    <td></td>         
	                </tr>
	            </thead>
	            <tbody class="tbody_params">
	            	<tr>
	                    <td>类型</td>
	                    <td>名称</td>
	                    <td>说明</td>
	                    <td>备注</td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>$data.device_info</td>
	                    <td>设备号</td>
	                    <td>非必须,可以为终端设备号(门店号或收银设备ID),PC网页或公众号内支付可以传"WEB"</td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>$data.body(128)</td>
	                    <td>商品描述</td>
	                    <td>浏览器打开的网站主页title名-商品概述</td>
	                </tr>
	                <tr>
	                    <td>string(6000)</td>
	                    <td>$data.detail</td>
	                    <td>商品详细描述</td>
	                    <td>非必须,请参阅上面detail详细说明</td>
	                </tr>
	                <tr>
	                    <td>string(127)</td>
	                    <td>$data.attach</td>
	                    <td>附加数据</td>
	                    <td>非必须,在查询API和支付通知中原样返回,可作为自定义参数使用</td>
	                </tr>
	                <tr>
	                    <td>string(32)</td>
	                    <td>$data.out_trade_no</td>
	                    <td>商户订单号</td>
	                    <td>非必须,不传系统默认生成</td>
	                </tr>
	                <tr>
	                    <td>string(16)</td>
	                    <td>$data.fee_type</td>
	                    <td>货币类型</td>
	                    <td>非必须,不传默认CNY</td>
	                </tr>
	                <tr>
	                    <td>integer</td>
	                    <td>$data.total_fee</td>
	                    <td>订单总金额</td>
	                    <td>单位分</td>
	                </tr>
	                <tr>
	                    <td>integer</td>
	                    <td>$data.expire</td>
	                    <td>过期时间</td>
	                    <td>单位秒</td>
	                </tr>
	                <tr>
	                    <td>string(32)</td>
	                    <td>$data.goods_tag</td>
	                    <td>订单优惠标记</td>
	                    <td>非必须,在goods_tag配置项中设置了goods_tag(内容自定义),则只有在支付接口中上传了该参数给微信,goods_tag内容与配置内容相同,且支付金额满足代金券使用条件才会触发代金券的使用.不设置则只要支付金额满足条件就会触发代金券的使用</td>
	                </tr>
	                <tr>
	                    <td>string(16)</td>
	                    <td>$data.trade_type</td>
	                    <td>交易类型</td>
	                    <td>JSAPI支付或小程序支付;NATIVE,Native支付;APP,app支付;MWEB,H5支付;MICROPAY,付款码支付</td>
	                </tr>
	                <tr>
	                    <td>string(32)</td>
	                    <td>$data.product_id</td>
	                    <td>商品ID</td>
	                    <td>trade_type=NATIVE时,此参数必传.此参数为二维码中包含的商品ID,商户自行定义.</td>
	                </tr>
	                <tr>
	                    <td>string(32)</td>
	                    <td>$data.limit_pay</td>
	                    <td>指定支付方式</td>
	                    <td>非必须,详情请查看https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=4_2参数规定一节</td>
	                </tr>
	                <tr>
	                    <td>string(128)</td>
	                    <td>$data.openid</td>
	                    <td>用户openid</td>
	                    <td>非必须,trade_type=JSAPI时(即JSAPI支付)此参数必传,此参数为微信用户在商户对应appid下的唯一标识</td>
	                </tr>
	                <tr>
	                    <td>string(8)</td>
	                    <td>$data.receipt</td>
	                    <td>电子发票入口开放标识</td>
	                    <td>非必须,传入Y时，支付成功消息和支付详情页将出现开票入口</td>
	                </tr>
	                <tr>
	                    <td>array</td>
	                    <td>$data.scene_info</td>
	                    <td>场景信息,H5支付必须</td>
	                    <td><pre>
NATIVE/JSAPI支付下
[
	"store_info" => [
		"id" => "",<span class="note">门店编号(string 32),非必须,商户自定义</span> 
		"name" => "",<span class="note">门店名称(string 64),非必须,商户自定义</span>
		"area_code" => "",<span class="note">门店所在地行政区划码,非必须,请参阅https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1</span>
		"address" => ""<span class="note">门店详细地址(string 128),非必须</span>
	]
]

H5支付下:
1,IOS移动应用
[
	"h5_info" => [
    	"type" => "IOS",  <span class="note">[场景类型]</span>
     	"app_name" => "",<span class="note">[应用名]</span>
     	"bundle_id" =>  ""<span class="note">[bundle_id]</span>
    ]
]
2,安卓移动应用
[	"h5_info" => [
		"type" => "",
     	"app_name" => "Android",
     	"package_name" => ""<span class="note">[包名]</span>
    ]
]
3,WAP网站应用
[
	"h5_info" => [
   		"type" => "Wap",
    	"wap_url" => "",<span class="note">[WAP网站URL地址]</span>
    	"wap_name" => ""<span class="note">[WAP网站名称]</span>
    ]
]
						</pre></td>
	                </tr>
	            </tbody>
	       	</table>

	       	<table class="tbl_params">
	            <thead class="thead_params">
	                <tr>
	                    <td>调用示例</td>       
	                </tr>
	            </thead>
	            <tbody class="tbody_params">
	                <tr><td><pre>
支付二维码示例(NATIVE):
$data = [
	"device_info" => "WEB",
	"body" => "商品描述",
	"detail" => [
	    "cost_price" => 608800, 
	    "receipt_id" => "wx123", 
	    "goods_detail" => [ //注意goods_detail字段的格式为"goods_detail":[[]],较多商户写成"goods_detail":[]
	        [
	            "goods_id" => "商品编码", 
	            "wxpay_goods_id" => "1001", 
	            "goods_name" => "", 
	            "quantity" => 1, 
	            "price" => 528800
	        ], 
	        [
	            "goods_id" => "商品编码", 
	            "wxpay_goods_id" => "1002", 
	            "goods_name" => "iPhone6s 32G", 
	            "quantity" => 1, 
	            "price" => 608800
	        ]
	    ]
	],
	"attach" => "附加数据",
	"total_fee" => "608800",
	"expire" => 300,
	"goods_tag" => "WXG",
	"trade_type" => "NATIVE",
	"product_id" => "12235413214070356458058"
];
Wechat::getInstance()->unifiedOrder($data);
	                    </pre></td>
	                </tr>
	                <tr><td><pre>
JSAPI示例:
$data = [
	"body" => "商品描述",
	"attach" => "附加数据",
	"total_fee" => "608800",
	"expire" => 300,
	"goods_tag" => "WXG",
	"trade_type" => "JSAPI",
	"openid" => "oUpF8uMuAJO_M2pxb1Q9zNjWeS6o"
];
Wechat::getInstance()->unifiedOrder($data);
	                    </pre></td>
	                </tr>
	                <tr><td><pre>
H5支付示例:
$data = [
	"body" => "商品描述",
	"attach" => "附加数据",
	"total_fee" => "608800",
	"expire" => 300,
	"goods_tag" => "WXG",
	"trade_type" => "MWEB",
	"scene_info" => [
		"h5_info" => [
	   		"type" => "Wap",
	    	"wap_url" => "https://pay.qq.com",
	    	"wap_name" => "腾讯充值"
	    ]
	]
];
Wechat::getInstance()->unifiedOrder($data);
	                    </pre></td>
	                </tr>
	            </tbody>
	       	</table>
	       	<table class="tbl_params">
	            <thead class="thead_params">
	                <tr>
	                    <td width="10%">返回参数说明</td>
	                    <td width="10%"></td>
	                    <td width="20%"></td>
	                    <td></td>         
	                </tr>
	            </thead>
	            <tbody class="tbody_params">
	            	<tr>
	                    <td>类型</td>
	                    <td>名称</td>
	                    <td>说明</td>
	                    <td>备注</td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>appid</td>
	                    <td>公共号appid</td>
	                    <td></td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>mch_id</td>
	                    <td>商户号</td>
	                    <td></td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>openid</td>
	                    <td>用户openid</td>
	                    <td>NATIVE时没有此地段</td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>device_info</td>
	                    <td>设备号</td>
	                    <td>非必须</td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>nonce_str</td>
	                    <td>随机字符串</td>
	                    <td></td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>sign</td>
	                    <td>签名</td>
	                    <td></td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>trade_type</td>
	                    <td>交易类型</td>
	                    <td></td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>prepay_id</td>
	                    <td>预支付交易会话标识</td>
	                    <td></td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>code_url</td>
	                    <td>二维码地址</td>
	                    <td>当交易类型为NATIVE(二维码支付)有此值,"http://paysdk.weixin.qq.com/example/qrcode.php?data=" . urlencode($result["code_url"]);为生成的支付二维码</td>
	                </tr>
	                <tr>
	                    <td>string</td>
	                    <td>mweb_url</td>
	                    <td>支付跳转链接</td>
	                    <td>H5支付有此地段,mweb_url为拉起微信支付收银台的中间页面,可通过访问该url来拉起微信客户端,完成支付,mweb_url的有效期为5分钟.需要拼接'&redirect_url=' . urlencode($redirect_url),支付成功后微信跳转到redirect_url指定的地址上</td>
	                </tr>
	            </tbody>
	       	</table>
	       	<table class="tbl_params">
	            <thead class="thead_params">
	                <tr>
	                    <td>返回参数示例</td>       
	                </tr>
	            </thead>
	            <tbody class="tbody_params">
	            	<tr>
	                    <td><pre>
二维码支付示例:
[
	"appid" => "wxdaa43d75b815f44e",
	"mch_id" => "1347427701",
	"nonce_str" => "IITRi8Iabbblz1Jc",
	"sign" => "7921E432F65EB8ED0CE9755F0E86D72F",
	"prepay_id" => "wx201411101639507cbf6ffd8b0779950874",
	"trade_type" => "NATIVE",
	"code_url" => "weixin://wxpay/bizpayurl/up?pr=NwY5Mz9&groupid=00"
]
	                	</pre></td>
	                </tr>
					<tr>
	                    <td><pre>
JSAPI示例:
[
	"appid" => "wxdaa43d75b815f44e",
	"mch_id" => "1347427701",
	"nonce_str" => "IITRi8Iabbblz1Jc",
	"sign" => "7921E432F65EB8ED0CE9755F0E86D72F",
	"prepay_id" => "wx201411101639507cbf6ffd8b0779950874",
	"trade_type" => "JSAPI"
]
	                	</pre></td>
	                </tr>
	                <tr>
	                    <td><pre>
H5示例:
[
	"appid" => "wxdaa43d75b815f44e",
	"mch_id" => "1347427701",
	"nonce_str" => "IITRi8Iabbblz1Jc",
	"sign" => "7921E432F65EB8ED0CE9755F0E86D72F",
	"prepay_id" => "wx201411101639507cbf6ffd8b0779950874",
	"trade_type" => "MWEB",
	"mweb_url" => "https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx2016121516420242444321ca0631331346&package=1405458241"
]
	                	</pre></td>
	                </tr>
	            </tbody>
	       	</table>
        </div>
    </div>
</body>
</html>